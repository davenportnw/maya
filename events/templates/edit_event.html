{% extends "base.html" %}
{% load bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}

<!DOCTYPE html>
<html>
<head>
    <title>Edit Event</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://unpkg.com/gijgo@1.9.14/js/gijgo.min.js" type="text/javascript"></script>
    <link href="https://unpkg.com/gijgo@1.9.14/css/gijgo.min.css" rel="stylesheet" type="text/css" />
</head>
</head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<body>
    {% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-4">
            <br/>
            <div class="mb-3 d-flex flex-column align-items-center">
                <div class="row">
                    <div class="col">
                        <form method="post" action="{% url 'edit_event' event.id %}">
                            {% csrf_token %}
                            <label for="event_name" class="font-monospace text-wrap">Update Name For:</label>
                            <label for="event_name" class="font-monospace text-wrap">{{ event.name|truncatechars:20 }}'</label>
                            <div class="row align-items-center">
                                <div class="col-9">
                                    <input type="text" class="form-control" id="event_name" name="event_name" value="{{ event.name }}">
                                </div>
                                <div class="col-3">
                                <button type="submit" class="btn" style="border-color: #86A08C; color:#86A08C; ">âœ“</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- Messages -->
                {% if messages %}
                    <div class="container">
                        {% for message in messages %}
                            <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-{{ message.tags }}{% endif %} d-flex align-items-center " role="alert">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
                <!-- Collaboration -->
                <form method="post" action="{% url 'send_invitation' event.id %}">
                    {% csrf_token %}
                    <input type="text" name="invitee_username" placeholder="Username of collaborator">
                    <button type="submit">Send Invitation</button>
                </form>
                <ul>
                    {% for item in invited_users_with_invitations %}
                    <li>
                        {{ item.user.username }}
                        <form action="{% url 'cancel_invitation' invitation_id=item.invitation_id %}" method="post" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" onclick="return confirm('Are you sure you want to cancel this invitation?');">X</button>
                        </form>
                    </li>
                        {% empty %}
                    <li>No users have been invited yet.</li>
                    {% endfor %}
                </ul>
                <p>Owner: {{ event.user.username }}</p>
                <h4>Collaborators</h4>
                <ul>
                    {% for person in collaborators %}
                    <li>
                        {{ person.first_name }}
                    </li>
                    {% empty %}
                    <p>No collaborators</p>
                    {% endfor %}
                </ul>
                <div class="row justify-content-center">
                     <!-- Back Button -->
                     <div class="col-auto">
                        <a href="{% url 'index' %}" class="btn" style="background-color: #092C27; border-color: #092C27; color:white;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
                            </svg>
                            Back
                        </a>
                    </div>
                    <!-- Delete Button -->
                    <div class="col-auto">
                        <div class="d-flex bg-transparent justify-content-center" onsubmit="return confirmDelete('{{ event.name }}')">
                            <form method="post" action="{% url 'events:delete_event' event.id %}">
                                {% csrf_token %}
                                    <button type="submit" class="btn btn-outline-danger">Delete Event</button>  
                            </form> 
                            <script>
                                function confirmDelete(eventName) {
                                    var result = confirm("Are you sure you want to delete" + " ' " + eventName + " ' " + "event?");
                                    console.log('result: ', result);
                                    if (!result) {
                                        event.preventDefault();
                                        return false;
                                    }
                                    return true;
                                }
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}
</div>
</body>
</html>
